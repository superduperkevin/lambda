"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3183],{4958:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});const o={props:["model","rule","label","meta"],data:()=>({preSource:[],modal_grid_show:!1,user_condition:null,selectedRow:{}}),computed:{value(){return this.model.form[this.model.component]}},watch:{value(e,t){null!==this.value&&0!==this.value&&""!==this.value||(this.selectedRow={}),e&&!t&&0==Object.keys(this.selectedRow).length&&this.callRowData()}},mounted(){void 0!==this.meta.GSOption.sourceGridUserCondition&&null!==this.meta.GSOption.sourceGridUserCondition&&""!=this.meta.GSOption.sourceGridUserCondition&&(this.user_condition=JSON.parse(this.meta.GSOption.sourceGridUserCondition))},methods:{callRowData(){let e={};e[this.meta.GSOption.sourceGridValueField]=this.value,axios.post(`${this.sourceGridUrl()}/lambda/puzzle/grid/data/${this.meta.GSOption.sourceGridID}?&paginate=1&page=1&sort=id&order=desc`,e).then((({data:e})=>{e.data.length>=1&&(this.selectedRow=e.data[0])}))},onRowSelect(e){this.preSource=e},sourceGridUrl(){if(window.init.microserviceSettings){let e=window.init.microserviceSettings.findIndex((e=>e.project_id==this.meta.GSOption.sourceMicroserviceID));return e>=0?window.init.microserviceSettings[e].production_url:""}return""},showAddSourceModal(){this.modal_grid_show=!0,this.$modal.show(`grid-modal-${this.meta.GSOption.sourceGridID}`)},closeSourceModal(){this.modal_grid_show=!1,this.$modal.hide(`grid-modal-${this.meta.GSOption.sourceGridID}`)},addFromPreSource(){this.selectedRow={},this.preSource&&this.meta.GSOption.sourceGridTargetColumns&&this.preSource.length>=1&&(this.selectedRow=this.preSource[0],this.model.form[this.model.component]=this.selectedRow[this.meta.GSOption.sourceGridValueField]),this.closeSourceModal()}}};const s=(0,i(51900).Z)(o,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"subform-grid"},[i("FormItem",{attrs:{label:e.label,prop:e.rule}},[i("div",{staticClass:"subform-header"},[e._v("\n            "+e._s(e.meta.GSOption.sourceGridModalTitle)+"\n\n        ")]),e._v(" "),i("table",{attrs:{border:"1"}},[i("thead",[i("tr",[e._l(e.meta.GSOption.sourceGridTargetColumns,(function(t){return i("th",{key:t.index},[e._v("\n                    "+e._s(t.label)+"\n                ")])})),e._v(" "),i("th",{staticClass:"action"},[e._v("...")])],2)]),e._v(" "),i("tbody",[i("tr",[e._l(e.meta.GSOption.sourceGridTargetColumns,(function(t){return i("td",{key:t.index},[e._v("\n                    "+e._s(e.selectedRow[t.model])+"\n                ")])})),e._v(" "),i("td",{staticClass:"action"},[e.meta.disabled?e._e():i("a",{attrs:{href:"javascript:void(0);"},on:{click:e.showAddSourceModal}},[i("Icon",{attrs:{type:"md-search"}})],1)])],2)])])]),e._v(" "),i("paper-modal",{staticClass:"form-modal",attrs:{name:"grid-modal-"+e.meta.GSOption.sourceGridID,"min-width":200,"min-height":100,"pivot-y":.5,adaptive:!0,reset:!0,draggable:!0,resizable:!0,draggable:".form-tool",width:"800",height:"70%"}},[i("section",{staticClass:"form-modal source-grid"},[i("div",{staticClass:"form-tool "},[i("h4",[e._v(e._s(e.meta.GSOption.sourceGridModalTitle))]),e._v(" "),i("div",{staticClass:"form-tool-actions"},[i("a",{attrs:{href:"javascript:void(0)"},on:{click:e.closeSourceModal}},[i("i",{staticClass:"ti-close"})])])]),e._v(" "),e.modal_grid_show?i("div",{staticClass:"form-body"},[e.meta.GSOption.sourceGridTitle&&e.meta.GSOption.sourceGridDescription?i("div",{staticClass:"source-grid-description"},[i("h3",[e._v("\n                        "+e._s(e.meta.GSOption.sourceGridTitle)+"\n                    ")]),e._v(" "),i("p",{domProps:{innerHTML:e._s(e.meta.GSOption.sourceGridDescription)}})]):e._e(),e._v(" "),i("datagrid",{attrs:{schemaID:e.meta.GSOption.sourceGridID,url:e.sourceGridUrl(),onRowSelect:e.onRowSelect,paginate:50,hasSelection:!0,gridSelector:!0,user_condition:e.user_condition,permissions:{c:!1,r:!0,u:!1,d:!1}}}),e._v(" "),i("div",{staticClass:"add-from-pre-source"},[i("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"success",size:"small",disabled:0==e.preSource.length,icon:"md-add"},on:{click:e.addFromPreSource}},[e._v("Сонгох")])],1)],1):e._e()])])],1)}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=form-field-GridSelector.3c1f2f7e54a68dfd.js.map